{%- if section.blocks.size > 0 -%}
    {%- render 'section-spacing-collapsing' -%}
  
    <style>
      #shopify-section-{{ section.id }} {
        --logo-list-item-max-size: 280px;
        --logo-list-grid: {% if section.settings.stack_mobile %}auto-flow 1fr / repeat(var(--logo-list-items-per-row), minmax(0, var(--logo-list-item-max-size))){% else %}1fr / auto-flow 52vw{% endif %};
        --logo-list-items-per-row: {{ 2 | at_most : section.blocks.size }};
        --logo-list-items-border: {{ section.settings.logo_item_border.rgb }} / {{ section.settings.logo_item_border.alpha }};
      }
  
      @media screen and (min-width: 700px) {
        #shopify-section-{{ section.id }} {
          --logo-list-grid: auto-flow 1fr / repeat(var(--logo-list-items-per-row), minmax(0, var(--logo-list-item-max-size)));
          --logo-list-items-per-row: {{ 3 | at_most : section.blocks.size }};
        }
      }
  
      @media screen and (min-width: 1000px) {
        #shopify-section-{{ section.id }} {
          --logo-list-items-per-row: {{ 4 | at_most: section.settings.items_per_row | at_most: section.blocks.size }};
        }
      }
  
      @media screen and (min-width: 1150px) {
        #shopify-section-{{ section.id }} {
          --logo-list-items-per-row: {{ section.settings.items_per_row | at_most: section.blocks.size }};
        }
      }

      .cust-logo-list .cust-logo-list_lgtitle {
        color: {{ section.settings.logo_text_color }};
      }

      .cust-logo-list .logo-list__item:hover .cust-logo-list_lgtitle {
        color: {{ section.settings.logo_hover_text_color }};
        transition: all .3s;
      }
    </style>
  
    <div {% render 'section-properties' %}>
      <div class="section-stack {% if section.settings.text_alignment == 'center' %}sm:justify-items-center{% endif %}">
        <div class="prose {% if section.settings.text_alignment == 'center' %}text-center{% endif %}">
          {%- if section.settings.title != blank -%}
            <h2 class="h2 cust-logo-list__heading">
              {%- render 'styled-text', content: section.settings.title, text_color: section.settings.heading_color, gradient: section.settings.heading_gradient -%}
            </h2>
          {%- endif -%}
          {% for block in section.blocks %}
              {%- if block.settings.logo_content != blank -%}
              <p class="cust-logo-list__subheading {% if forloop.first %}active {% endif %}" data-id={{ block.id }}>
                {{ block.settings.logo_content }}
              </p>
            {% endif %}
          {% endfor %}
        </div>
  
        <reveal-items class="logo-list {% unless section.settings.stack_mobile %}scroll-area bleed sm:unbleed{% endunless %}">
          {%- for block in section.blocks -%}
            {%- liquid
              assign loading_strategy = nil
    
              if section.index > 3 or forloop.index > 3
                assign loading_strategy = 'lazy'
              endif
            -%}
  
            {%- capture block_content -%}
              
              {%- if block.settings.logo != blank -%}
                {%- capture sizes -%}{{ block.settings.logo_width }}px{%- endcapture -%}
                {%- capture widths -%}{{ block.settings.logo_width }}, {{ block.settings.logo_width | times: 2 | at_most: block.settings.logo.width }}{%- endcapture -%}
                {%- capture max_width -%}--logo-list-image-max-width: {{ block.settings.logo_width }}px{%- endcapture -%}
                {{- block.settings.logo | image_url: width: block.settings.logo.width | image_tag: style: max_width, loading: loading_strategy, widths: widths, class: 'logo-list__image', sizes: sizes -}}
                {% elsif block.settings.logo_title != blank %}
                  <div class="cust-logo-list_lgtitle"
                    >{{ block.settings.logo_title }}</div>
                {% else %}
                {{- 'image' | placeholder_svg_tag: 'logo-list__image' -}}
              {%- endif -%}
            {%- endcapture -%}
            {% comment %}
              , background_fallback: 'bg-secondary' 
             {% endcomment %}
            {% capture item_attribute %}
             {% assign custom_class = 'logo-list__item' %}
              {% if forloop.first %}
                 {% assign custom_class = 'logo-list__item active' %}
              {% endif %}
             {%- render 'surface', class: custom_class, background: section.settings.logo_item_background -%}
            {%- endcapture -%}
  
            {%- if block.settings.link != blank -%}
              <a href="{{ block.settings.link }}" {{ item_attribute }} {{ block.shopify_attributes }} data-id={{ block.id }} aria-label="link">
                {{- block_content -}}
              </a>
            {%- else -%}
              <div {{ item_attribute }} {{ block.shopify_attributes }} data-id={{ block.id }}>
                {{- block_content -}}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </reveal-items>
      </div>
    </div>
  {%- endif -%}
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.querySelector('#shopify-section-{{ section.id }}.cust-logo-list');
    const iconBtns = container.querySelectorAll('.logo-list__item');
    const contentEles = container.querySelectorAll('.cust-logo-list__subheading');

    iconBtns.forEach((btn) => {
      btn.addEventListener('mouseenter', () => {
        container.querySelector('.logo-list__item.active').classList.remove("active");
        container.querySelector('.cust-logo-list__subheading.active').classList.remove("active");
        btn.classList.add("active");
        container.querySelector('.cust-logo-list__subheading[data-id="'+ btn.dataset.id+'"]').classList.add("active");
      });
    });

    const mouseEnterEvent = new MouseEvent('mouseenter', {
      bubbles: true,
      cancelable: true,
      view: window
    });
    
    setInterval(() => {
      const activeElement = container.querySelector('.logo-list__item.active');
      const activeIndex = Array.from(iconBtns).indexOf(activeElement) + 1;
      iconBtns[activeIndex]?iconBtns[activeIndex].dispatchEvent(mouseEnterEvent):iconBtns[0].dispatchEvent(mouseEnterEvent);
    }, 5000); 
    
  });
</script>
  {% schema %}
  {
    "name": "Cust logo list",
    "class": "shopify-section--logo-list cust-logo-list",
    "tag": "section",
    "disabled_on": {
      "templates": ["password"],
      "groups": ["header", "custom.overlay"]
    },
    "settings": [
      {
        "type": "checkbox",
        "id": "full_width",
        "label": "Full width",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "stack_mobile",
        "label": "Stack on mobile",
        "default": false
      },
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Logo list"
      },
      {
        "type": "select",
        "id": "text_alignment",
        "label": "Text alignment",
        "options": [
          {
            "value": "start",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          }
        ],
        "default": "center"
      },
      {
        "type": "range",
        "id": "items_per_row",
        "min": 3,
        "max": 6,
        "label": "Items per row (desktop)",
        "default": 6
      },
      {
        "type": "header",
        "content": "Colors",
        "info": "Gradient replaces solid colors when set."
      },
      {
        "type": "color",
        "id": "background",
        "label": "Background"
      },
      {
        "type": "color_background",
        "id": "background_gradient",
        "label": "Background gradient"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text"
      },
      {
        "type": "color",
        "id": "heading_color",
        "label": "Heading color"
      },
      {
        "type": "color_background",
        "id": "heading_gradient",
        "label": "Heading gradient"
      },
      {
        "type": "color",
        "id": "logo_text_color",
        "label": "Logo text color",
        "default": "#C2C2C2"
      },
      {
        "type": "color",
        "id": "logo_hover_text_color",
        "label": "Logo hover text color",
        "default": "#1C1C1E"
      },
      {
        "type": "color",
        "id": "logo_item_background",
        "label": "Logo background"
      },
      {
        "type": "color",
        "id": "logo_item_border",
        "label": "Logo border"
      }
    ],
    "blocks": [
      {
        "type": "logo",
        "name": "Logo",
        "settings": [
          {
            "type": "text",
            "id": "logo_title",
            "label": "Logo title",
            "info": "If the text is empty, display the logo image, if it is not empty, display the text",
            "default": "logo"
          },
          {
            "type": "text",
            "id": "logo_content",
            "label": "Logo content"
          },
          {
            "type": "image_picker",
            "id": "logo",
            "label": "Logo",
            "info": "300 x 90px .jpg recommended"
          },
          {
            "type": "range",
            "id": "logo_width",
            "min": 50,
            "max": 300,
            "unit": "px",
            "step": 10,
            "label": "Logo width",
             "info": "Only take effect on logo images",
            "default": 120
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Cust logo list",
        "blocks": [
          {
            "type": "logo"
          },
          {
            "type": "logo"
          },
          {
            "type": "logo"
          },
          {
            "type": "logo"
          },
          {
            "type": "logo"
          },
          {
            "type": "logo"
          }
        ]
      }
    ]
  }
  {% endschema %}